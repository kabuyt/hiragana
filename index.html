<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ひらがなクイズ</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }
    #question {
      font-size: 96px;
      margin: 30px 0;
    }
    .choice {
  font-size: 32px;
  padding: 10px 20px;
  margin: 10px auto;
  display: block;
  width: 100%;
  max-width: 300px;
  box-sizing: border-box;
}
    #filters {
      margin-bottom: 20px;
    }
  #choices {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.choice {
  font-size: 32px;
  padding: 10px 20px;
  width: 90%;
  max-width: 300px;
  box-sizing: border-box;
  margin: 10px auto;
}
</style>
</head>
<body>
  

  <div id="quizApp" style="display: none;">
    <div id="filters"></div>
    <div id="question"></div>
    <div id="choices"></div>
  </div>

  <script>
    const fullQuizData = {
      a: ["あ", "い", "う", "え", "お"],
      ka: ["か", "き", "く", "け", "こ"],
      sa: ["さ", "し", "す", "せ", "そ"],
      ta: ["た", "ち", "つ", "て", "と"],
      na: ["な", "に", "ぬ", "ね", "の"],
      ha: ["は", "ひ", "ふ", "へ", "ほ"],
      ma: ["ま", "み", "む", "め", "も"],
      ya: ["や", "ゆ", "よ"],
      ra: ["ら", "り", "る", "れ", "ろ"],
      wa: ["わ", "を", "ん"],
      dakuon: ["が", "ぎ", "ぐ", "げ", "ご", "ざ", "じ", "ず", "ぜ", "ぞ", "だ", "ぢ", "づ", "で", "ど", "ば", "び", "ぶ", "べ", "ぼ", "ぱ", "ぴ", "ぷ", "ぺ", "ぽ"],
      youon: ["きゃ", "きゅ", "きょ", "しゃ", "しゅ", "しょ", "ちゃ", "ちゅ", "ちょ", "にゃ", "にゅ", "にょ", "ひゃ", "ひゅ", "ひょ", "みゃ", "みゅ", "みょ", "りゃ", "りゅ", "りょ", "ぎゃ", "ぎゅ", "ぎょ", "じゃ", "じゅ", "じょ", "びゃ", "びゅ", "びょ", "ぴゃ", "ぴゅ", "ぴょ"],
      words: [
        { kana: "はな", romaji: "hana" },
        { kana: "みず", romaji: "mizu" },
        { kana: "いえ", romaji: "ie" },
        { kana: "ゆき", romaji: "yuki" },
        { kana: "くも", romaji: "kumo" },
        { kana: "あめ", romaji: "ame" },
        { kana: "さけ", romaji: "sake" },
        { kana: "つき", romaji: "tsuki" },
        { kana: "こえ", romaji: "koe" },
        { kana: "そら", romaji: "sora" }
      ],
      words3: [
        { kana: "あさひ", romaji: "asahi" },
        { kana: "おみせ", romaji: "omise" },
        { kana: "くすり", romaji: "kusuri" },
        { kana: "たまご", romaji: "tamago" },
        { kana: "うんてん", romaji: "unten" },
        { kana: "まくら", romaji: "makura" },
        { kana: "やきにく", romaji: "yakiniku" },
        { kana: "きもの", romaji: "kimono" },
        { kana: "さかな", romaji: "sakana" },
        { kana: "ほんや", romaji: "honya" }
      ]
    };

    let quizData = [];
    let currentQuestion = {};

    function getSelectedGroups() {
      return Array.from(document.querySelectorAll("input[name='group']:checked")).map(el => el.value);
    }

    function updateQuizData() {
  quizData = [];
  const groups = getSelectedGroups();
  groups.forEach(group => {
    if (fullQuizData[group]) {
      if (group === "words" || group === "words3") {
        quizData = quizData.concat(fullQuizData[group]);
      } else {
        quizData = quizData.concat(fullQuizData[group].map(kana => ({ kana: kana, romaji: toRomaji(kana) })));
      }
    }
  });
}

function setQuestion() {
      updateQuizData();
      if (quizData.length === 0) {
        const q = document.getElementById("question");
        q.textContent = "出題範囲を選んでください";
        q.style.fontSize = "20px";
        document.getElementById("choices").innerHTML = "";
        return;
      }
      currentQuestion = quizData[Math.floor(Math.random() * quizData.length)];
      const displayKana = typeof currentQuestion === "string" ? currentQuestion : currentQuestion.kana;
      document.getElementById("question").textContent = displayKana;
      document.getElementById("question").style.fontSize = "";

      let romaji;
      if (typeof currentQuestion === "string") {
        romaji = toRomaji(currentQuestion);
      } else {
        romaji = currentQuestion.romaji;
      }

      const choices = shuffle([romaji, ...generateWrongChoices(romaji)]).slice(0, 4);
      document.getElementById("choices").innerHTML = choices.map(choice => `<button class="choice" onclick="checkAnswer('${choice}')">${choice}</button>`).join("");
    }

    function checkAnswer(selected) {
  const correct = typeof currentQuestion === "string" ? toRomaji(currentQuestion) : currentQuestion.romaji;
  const resultText = selected === correct ? "Đúng!" : "Sai...";

  const resultDisplay = document.createElement("div");
  resultDisplay.textContent = resultText;
  resultDisplay.style.fontSize = "24px";
  resultDisplay.style.marginTop = "10px";
  document.getElementById("choices").appendChild(resultDisplay);

  setTimeout(() => {
    resultDisplay.remove();
    setQuestion();
  }, 1000);
    }

    function generateWrongChoices(correct) {
      const allRomaji = [
        "a", "i", "u", "e", "o", "ka", "ki", "ku", "ke", "ko",
        "sa", "shi", "su", "se", "so", "ta", "chi", "tsu", "te", "to",
        "na", "ni", "nu", "ne", "no", "ha", "hi", "fu", "he", "ho",
        "ma", "mi", "mu", "me", "mo", "ya", "yu", "yo", "ra", "ri",
        "ru", "re", "ro", "wa", "wo", "n"
      ];
      const wrong = [];
      while (wrong.length < 3) {
        const choice = allRomaji[Math.floor(Math.random() * allRomaji.length)];
        if (choice !== correct && !wrong.includes(choice)) {
          wrong.push(choice);
        }
      }
      return wrong;
    }

    function toRomaji(hiragana) {
  const map = {
    きゃ: "kya", きゅ: "kyu", きょ: "kyo",
    しゃ: "sha", しゅ: "shu", しょ: "sho",
    ちゃ: "cha", ちゅ: "chu", ちょ: "cho",
    にゃ: "nya", にゅ: "nyu", にょ: "nyo",
    ひゃ: "hya", ひゅ: "hyu", ひょ: "hyo",
    みゃ: "mya", みゅ: "myu", みょ: "myo",
    りゃ: "rya", りゅ: "ryu", りょ: "ryo",
    ぎゃ: "gya", ぎゅ: "gyu", ぎょ: "gyo",
    じゃ: "ja", じゅ: "ju", じょ: "jo",
    びゃ: "bya", びゅ: "byu", びょ: "byo",
    ぴゃ: "pya", ぴゅ: "pyu", ぴょ: "pyo",
    あ: "a", い: "i", う: "u", え: "e", お: "o",
    か: "ka", き: "ki", く: "ku", け: "ke", こ: "ko",
    さ: "sa", し: "shi", す: "su", せ: "se", そ: "so",
    た: "ta", ち: "chi", つ: "tsu", て: "te", と: "to",
    な: "na", に: "ni", ぬ: "nu", ね: "ne", の: "no",
    は: "ha", ひ: "hi", ふ: "fu", へ: "he", ほ: "ho",
    ま: "ma", み: "mi", む: "mu", め: "me", も: "mo",
    や: "ya", ゆ: "yu", よ: "yo",
    ら: "ra", り: "ri", る: "ru", れ: "re", ろ: "ro",
    わ: "wa", を: "wo", ん: "n",
    が: "ga", ぎ: "gi", ぐ: "gu", げ: "ge", ご: "go",
    ざ: "za", じ: "ji", ず: "zu", ぜ: "ze", ぞ: "zo",
    だ: "da", ぢ: "ji", づ: "zu", で: "de", ど: "do",
    ば: "ba", び: "bi", ぶ: "bu", べ: "be", ぼ: "bo",
    ぱ: "pa", ぴ: "pi", ぷ: "pu", ぺ: "pe", ぽ: "po"
  };
  let result = "";
  for (let i = 0; i < hiragana.length; i++) {
    const two = hiragana.slice(i, i + 2);
    if (map[two]) {
      result += map[two];
      i++;
    } else {
      result += map[hiragana[i]] || "";
    }
  }
  return result;
}

function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    window.onload = () => {
  const filters = document.getElementById("filters");
  const groupLabels = {
    a: "あ行", ka: "か行", sa: "さ行", ta: "た行", na: "な行",
    ha: "は行", ma: "ま行", ya: "や行", ra: "ら行", wa: "わ行",
    dakuon: "だくおん", youon: "ようおん", words: "2文字単語", words3: "3文字単語"
  };
  for (const group in fullQuizData) {
    const isChecked = "";
    const labelName = groupLabels[group] || group;
    const label = document.createElement("label");
    label.innerHTML = `<input type="checkbox" name="group" value="${group}" ${isChecked}> ${labelName}`;
    filters.appendChild(label);
  }
  document.getElementById("quizApp").style.display = "block";
  setQuestion();
};
  </script>
</body>
</html>
